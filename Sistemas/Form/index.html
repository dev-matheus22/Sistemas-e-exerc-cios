<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel do Usu√°rio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://unpkg.com/intro.js/minified/introjs.min.css" rel="stylesheet">
  <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
  <link rel="shortcut icon" href="iconSapo.png" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Montserrat+Alternates:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }

  body {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: linear-gradient(135deg, #A8E6CF, #DCEDC1);
    font-family: 'Montserrat Alternates', sans-serif;
    width: 100%;
    margin-top: 0px;
    position: relative;
    overflow-y: auto;
  }

  .painel-usuario {
    flex-grow: 1;
    width: 100%;
    padding: 40px 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin-top: 300px;
  }

  .cor-navbar {
    background-color: #E0F7FA;
  }

  .fonte {
    font-family: 'Dancing script';
    color: #5e35b1;
  }

  .painel-usuario-bg {
    background: linear-gradient(135deg, #A8E6CF, #DCEDC1);
  }

  .card {
    margin-top: 20px;
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    width: 100%;
    max-width: 800px;
  }

  .botoes-usuario {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: space-around;
    margin-bottom: 30px;
  }

  .botao-acao {
    border: none;
    padding: 15px 20px;
    border-radius: 12px;
    color: white;
    font-weight: bold;
    transition: all 0.2s ease-in-out;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    min-width: 200px;
    text-align: center;
  }

  .botao-acao:hover { transform: scale(1.08); cursor: pointer; }

  .botao-acao-enviar { background-color: #f44336; }
  .botao-acao-enviar:hover { background-color: #d32f2f; }

  .botao-acao-sugestoes { background-color: #2196f3; }
  .botao-acao-sugestoes:hover { background-color: #1976d2; }

  .botao-acao-relatar { background-color: #ff9800; }
  .botao-acao-relatar:hover { background-color: #f57c00; }

  .botao-acao-confirmar { background-color: #4caf50; }
  .botao-acao-confirmar:hover { background-color: #388e3c; }

  .botao-acao-criar-template { background-color: #9c27b0; }
  .botao-acao-criar-template:hover { background-color: #7b1fa2; }

  .botao-acao-sair { background-color: #6c757d; }
  .botao-acao-sair:hover { background-color: #495057; }

  #formBug, #formTemplate, #formCorreioElegante, #formConfirmarPresenca {
    display: none;
    background-color: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .heart-effect {
    color: red;
    font-size: 2rem;
    animation: heartPulse 1s infinite;
  }

  .bg-correio-elegante {
    background: linear-gradient(135deg, #FF6F61, #D9A2A3);
  }

  .bg-editar-perfil {
    background: linear-gradient(135deg, #6F61FF, #A2A3D9);
  }

  .bg-relatar-bug {
    background: linear-gradient(135deg, #F57C00, #eb821a);
  }

  .bg-confirmar-presenca {
    background: linear-gradient(135deg, #61FF8D, #A3D9A2);
  }

  .bg-criar-template {
    background: linear-gradient(135deg, #7B1FA2, #6b2888);
  }

  @keyframes heartPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.5); opacity: 0.5; }
    100% { transform: scale(1); opacity: 1; }
  }

  .customTooltip {
    background-color: #1976d2;
    color: #333;
    border-radius: 10px;
    padding: 15px;
    font-size: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .introjs-tooltip-title {
    font-weight: bold;
    color: #0d6efd;
  }

  .introjs-button {
    border-radius: 8px;
    padding: 8px 12px;
  }

  .introjs-skipbutton {
    color: #dc3545 !important;
  }

  .footer-custom {
    width: 100%;
    background-color: #E0F7FA;
    padding: 20px 30px;
    margin-top: 30px;
    text-align: center;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .footer-content {
    max-width: 1200px;
    margin: 0;
    text-align: center;
    color: #5e35b1;
    font-weight: bold;
  }

  form, form label, form input, form textarea, form select, p > strong {
    color: #5e35b1;
  }

  .navbar-nav .btn {
    border: 2px solid #7e57c2;
    border-radius: 8px;
    padding: 8px 16px;
    background-color: transparent;
    color: #7e57c2;
    transition: background-color 0.3s, color 0.3s;
  }

  .navbar-nav .btn:hover {
    background-color: #7e57c2;
    color: white;
  }

  .navbar .container-fluid {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .navbar-brand {
    margin-right: 30px;
  }

  .fonte{
      font-family: 'Dancing script';
      color: #5e35b1;
  }
  
  @media (max-width: 768px) {

.navbar-collapse {
    position: absolute;
    top: 60px;
    right: 0;
    background-color: #E0F7FA;
    border-radius: 10px;
    width: 100%;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}


  .navbar-nav {
    flex-direction: column;
    align-items: flex-end !important;/* faz os bot√µes se alinharem √† direita */
  }
}

</style>
</head>
<body>
  <nav class="navbar navbar-expand-lg  cor-navbar fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
           <img src="Logo.webp" alt="" width="40" height="40" class="d-inline-block align-text-top">
            <span class="fonte">Beija Sapo</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav gap-2" style="margin-left: -270px;">
             <li class="nav-item">
            <a class="btn" href="index.html" style="color: #7e57c2;">
              <i class="bi bi-house-door"></i> Home
            </a>
          </li>
          <li class="nav-item">
            <a class="btn" href="loginAdm.html" style="color: #7e57c2;">
              <i class="bi bi-shield-lock"></i> Adm
            </a>
          </li>
          <li class="nav-item">
            <a class="btn" href="loginUser.html" style="color: #7e57c2;">
              <i class="bi bi-person"></i> Usu√°rio
            </a>
          </li>
          <li class="nav-item">
            <a class="btn" href="cadastroUsuario.html" style="color: #7e57c2;">
              <i class="bi bi-person-plus"></i> Cadastre-se
            </a>
          </li>
          <li class="nav-item">
            <a class="btn" href="galeria.php" style="color: #7e57c2;">
              <i class="bi bi-image"></i> Galeria
            </a>
          </li>
         
        </ul>
      </div>
    </div>
  </nav>

    <div class="painel-usuario">
      <div class="card">
        <h4 class="text-center mb-4" id="bemVindo">Bom te ver, sapinho üê∏!</h4>
    
        <div class="botoes-usuario">
          <button class="botao-acao botao-acao-enviar drag-btn" id="btnEnviarCorreioElegante"
            data-intro="Clique aqui para enviar um correio elegante para algu√©m do grupo!"
            data-step="1">
            <i class="bi bi-envelope"></i> Enviar correio elegante
          </button>
    
          <button class="botao-acao botao-acao-sugestoes drag-btn" id="btnVerPerfil"
            data-intro="Aqui voc√™ pode ver ou editar seu perfil."
            data-step="2">
            <i class="bi bi-pencil"></i> Editar perfil
          </button>
    
          <button class="botao-acao botao-acao-relatar drag-btn" id="relatarBugBtn"
            data-intro="Encontrou um erro? Relate um bug por aqui!"
            data-step="3">
            <i class="bi bi-bug"></i> Relatar um bug
          </button>
    
          <button class="botao-acao botao-acao-confirmar drag-btn" id="btnConfirmarPresenca"
            data-intro="Use esse bot√£o para confirmar sua presen√ßa nos rol√™s!"
            data-step="4">
            <i class="bi bi-calendar-check"></i> Confirmar presen√ßa
          </button>
    
          <button class="botao-acao botao-acao-criar-template drag-btn" id="btnCriarTemplate"
            data-intro="Aqui voc√™ pode criar seu template de apresenta√ß√£o. Bem-vinde, sapinho!"
            data-step="5">
            <i class="bi bi-plus-circle"></i> Criar Template
          </button>
    
          <button class="botao-acao botao-acao-sair drag-btn" id="btnSair"
            data-intro="Clique aqui para sair do painel."
            data-step="6">
            <i class="bi bi-door-open"></i> Sair
          </button>
        </div>
    
        <!-- Formul√°rio de Correio Elegante -->
        <div id="formCorreioElegante">
          <h5 class="text-center">‚ù§Ô∏è Enviar Correio Elegante ‚ù§Ô∏è</h5>
          <p>Utilize essa se√ß√£o para enviar aquela paquera para algu√©m do grupo!</p>
          <form id="correioForm">
            <div class="mb-3">
              <label for="destinatario" class="form-label">Destinat√°rio</label>
              <input type="text" class="form-control" id="destinatario" required placeholder="@fulano ou apenas fulano">
            </div>
            <div class="mb-3">
              <label for="remetente" class="form-label">Remetente</label>
              <input type="text" class="form-control" id="remetente" required placeholder="Seu nome ou an√¥nimo">
            </div>
            <div class="mb-3">
              <label for="mensagem" class="form-label">Mensagem</label>
              <textarea class="form-control" id="mensagem" rows="4" required  placeholder="Agora √© a hora xD"></textarea>
            </div>
            <button type="submit" class="btn btn-warning">Enviar</button>
          </form>
          <div id="correioStatus" class="mt-2 text-success" style="display:none;">Mensagem enviada com sucesso! <span class="heart-effect">‚ù§Ô∏è</span></div>
        </div>

        <!-- Formul√°rio de editar perfil -->

    
        <!-- Formul√°rio de Bug -->
        <div id="formBug">
          <h5 class="text-center">Relatar um Bug</h5>
          <form id="bugForm">
            <div class="mb-3">
              <label for="titulo" class="form-label">T√≠tulo</label>
              <input type="text" class="form-control" id="titulo" required>
            </div>
            <div class="mb-3">
              <label for="descricao" class="form-label">Descri√ß√£o</label>
              <textarea class="form-control" id="descricao" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn btn-warning">Enviar Bug</button>
          </form>
          <div id="bugStatus" class="mt-2 text-success" style="display:none;">Bug enviado com sucesso!</div>
        </div>
    
        <!-- Resultado Template -->
        <div id="resultadoTemplate" style="display:none; white-space:pre-line; margin-top: 20px;"></div>
    
        <!-- Formul√°rio de Template -->
        <div id="formTemplate">
          <form id="templateForm">
            <h5 class="text-center">Crie seu template de apresenta√ß√£o aqui, novo sapinho üê∏!</h5>
            <br>
            <div class="mb-3"><label class="form-label">Nome:</label><input type="text" class="form-control" id="nome"></div>
            <div class="mb-3"><label class="form-label">Idade:</label><input type="text" class="form-control" id="idade"></div>
            <div class="mb-3"><label class="form-label">Anivers√°rio:</label><input type="text" class="form-control" id="aniversario"></div>
            <div class="mb-3"><label class="form-label">Signo:</label><input type="text" class="form-control" id="signo"></div>
            <div class="mb-3"><label class="form-label">Altura:</label><input type="text" class="form-control" id="altura"></div>
            <div class="mb-3"><label class="form-label">Cidade e Bairro (SP):</label><input type="text" class="form-control" id="cidadeBairro"></div>
            <div class="mb-3"><label class="form-label">Estado Civil:</label><input type="text" class="form-control" id="estadoCivil"></div>
            <div class="mb-3"><label class="form-label">Hobbies:</label><input type="text" class="form-control" id="hobbies"></div>
            <div class="mb-3"><label class="form-label">Instagram:</label><input type="text" class="form-control" id="instagram"></div>
            <button type="button" class="btn btn-success" id="gerarTemplate">Gerar Template</button>
          </form>
        </div>
    
        <div id="resultadoTemplate" style="display: none; white-space: pre-line; margin-top: 20px;"></div>
        <button id="copiarTexto" class="btn btn-secondary mt-3" style="display: none;">Copiar texto</button>
        
        <div id="perfilContainer">
        <div class="card">
        <h5 class="text-center mb-4">Veja ou edite suas informa√ß√µes aqui!</h5>
        <div class="card-body">
             <div class="text-center my-3">

             <img id="fotoPerfil" src="https://via.placeholder.com/150" class="rounded-circle mb-2" style="width: 150px; height: 150px; object-fit: cover;" alt="Foto de Perfil">

             <div>
                <input type="file" id="uploadFoto" class="form-control mt-2" accept="image/*">-->
            <p><strong>Nome:</strong> <span id="perfilNome"></span> <button class="btn btn-warning btn-sm" id="editNome" style="color: #fff">‚úèÔ∏è Editar</button></p>
            <p><strong>Cidade:</strong> <span id="perfilCidade"></span> <button class="btn btn-warning btn-sm" id="editCidade" style="color: #fff">‚úèÔ∏èÔ∏è Editar</button></p>
            <p><strong>Telefone:</strong> <span id="perfilTelefone"></span> <button class="btn btn-warning btn-sm" id="editTelefone" style="color: #fff">‚úèÔ∏è Editar</button></p>
            <p><strong>Idade:</strong> <span id="perfilIdade"></span> anos <button class="btn btn-warning btn-sm" id="editIdade" style="color: #fff">‚úèÔ∏è Editar</button></p>
            <p><strong>Email:</strong> <span id="perfilEmail"></span> <button class="btn btn-warning btn-sm" id="editEmail" style="color: #fff">‚úèÔ∏è Editar</button></p>
            <p><strong>Sobre Voc√™:</strong> <span id="perfilSobre"></span> <button class="btn btn-warning btn-sm" id="editSobre" style="color: #fff">‚úèÔ∏è Editar</button></p>
            <!--<div class="text-center my-3">-->
            <!--  <img id="fotoPerfil" src="https://via.placeholder.com/150" class="rounded-circle mb-2" style="width: 150px; height: 150px; object-fit: cover;" alt="Foto de Perfil">-->
            <!--  <div>-->
                <!--<input type="file" id="uploadFoto" class="form-control mt-2" accept="image/*">-->
            <!--  </div>-->
          </div>
        </div>
      </div>
    

        
    
        <!-- Formul√°rio Confirmar Presen√ßa -->
        <div id="formConfirmarPresenca" style="display: none;">
          <h5 class="text-center">Confirmar Presen√ßa</h5>
          <div id="rol√™Info">
            <p style="color: #5e35b1;">Rol√™: <span id="nomeRole"></span></p>
            <p style="color: #5e35b1;">Data: <span id="dataRole"></span></p>
          </div>
          <form id="presencaForm">
            <div class="mb-3">
              <label class="form-label">Seu nome</label>
              <input type="text" id="nomeUsuario" class="form-control" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Voc√™ vai?</label>
              <select class="form-select" id="presenca" required>
                <option value="vou">Vou</option>
                <option value="naoVou">N√£o Vou</option>
                <option value="talvez">Talvez</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success">Enviar</button>
          </form>
          <div id="presencaStatus" class="mt-2 text-success" style="display:none;">Presen√ßa confirmada!</div>
        </div>
    
      </div> <!-- fecha .card -->
    </div> <!-- fecha .painel-usuario -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, updateEmail, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
  import {
  getFirestore, doc, getDoc, getDocs, setDoc, orderBy, limit,
  query, where, updateDoc, collection, addDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";



  const firebaseConfig = {
    apiKey: "AIzaSyDkMTTM5yJbyIzjCl3vovJXx1dlNEX2IpU",
    authDomain: "beija-sapo.firebaseapp.com",
    projectId: "beija-sapo",
    storageBucket: "beija-sapo.appspot.com",
    messagingSenderId: "429297677162",
    appId: "1:429297677162:web:3792b9546b7b44a16e6b13"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  

  // Verifica se √© a primeira vez (voc√™ pode melhorar isso com localStorage depois)
function iniciarTour() {
    introJs().setOptions({
      nextLabel: 'Pr√≥ximo',
      prevLabel: 'Voltar',
      doneLabel: 'Fechar',
      skipLabel: 'Pular',
      tooltipClass: 'customTooltip',
      steps: [
        {
          element: document.querySelector('#btnEnviarCorreioElegante'),
          intro: 'Aqui voc√™ pode mandar um correio elegante para o crush ‚ù§Ô∏è'
        },
        {
          element: document.querySelector('#btnEditarPerfil'),
          intro: 'Tem uma ideia incr√≠vel ou quer reclamar de algo ou algu√©m?? Conta pra gente aqui!'
        },
        {
          element: document.querySelector('#relatarBugBtn'),
          intro: 'Achou algum bug estranho? Tipo... um sapo pulando no c√≥digo? Relata aqui! üêû'
        },
        {
          element: document.querySelector('#btnConfirmarPresenca'),
          intro: 'Confirme sua presen√ßa nos eventos do grupo e n√£o fique de fora! üìÖ'
        },
        {
          element: document.querySelector('#btnCriarTemplate'),
          intro: 'Chegou agora e quer se apresentar? Crie seu template aqui, novo sapinho! üê∏'
        },
        {
          element: document.querySelector('.botao-acao-sair'),
          intro: 'Se quiser sair (mas s√≥ se for rapidinho hein?), clique aqui.'
        }
      ]
    }).start();
  }

  // Voc√™ pode chamar o tour automaticamente ou deixar um bot√£o no topo
  window.onload = function () {
    setTimeout(iniciarTour, 1000); // Espera 1 segundo antes de come√ßar
  };
  
   document.getElementById("btnSair").addEventListener("click", async () => {
    try {
      await signOut(auth); // Desloga do Firebase
      console.log("Usu√°rio deslogado");
      window.location.href = "index.html";  // Redireciona para a p√°gina inicial
    } catch (error) {
      console.error("Erro ao deslogar:", error);
    }
  });

    let usuarioDocId = null; // <- vari√°vel para guardar o ID do documento do usu√°rio


// Fun√ß√£o para editar os campos (coloca antes!)
const editarCampo = (campoId, campoValor) => {
  const campoSpan = document.getElementById(campoId);
  const valorAtual = campoSpan.textContent;

  campoSpan.innerHTML = `<input type="text" value="${valorAtual}" id="input${campoId}" />`;

  const botaoSalvar = document.createElement("button");
  botaoSalvar.classList.add("btn", "btn-primary", "btn-sm");
  botaoSalvar.textContent = "Salvar";

  botaoSalvar.onclick = async () => {
    const novoValor = document.getElementById(`input${campoId}`).value;

    try {
      const usuarioDocRef = doc(db, "usuarios", usuarioDocId); // <- usa o ID certo agora
      await updateDoc(usuarioDocRef, {
        [campoValor]: novoValor
      });
      campoSpan.textContent = novoValor;
    } catch (error) {
      console.error("Erro ao salvar altera√ß√£o:", error);
    }
  };

  campoSpan.innerHTML += " ";
  campoSpan.appendChild(botaoSalvar);
};

// Depois vem o seu onAuthStateChanged
onAuthStateChanged(auth, async (user) => {
  if (user) {
    const uid = user.uid;
    console.log("Usu√°rio logado:", uid);

    try {
      const usuariosRef = collection(db, "usuarios");
      const q = query(usuariosRef, where("userId", "==", uid));
      const querySnapshot = await getDocs(q);

      if (!querySnapshot.empty) {
        querySnapshot.forEach((documento) => {
          const data = documento.data();
          usuarioDocId = documento.id;

          document.getElementById("perfilNome").textContent = data.nome;
          document.getElementById("perfilCidade").textContent = data.cidade;
          document.getElementById("perfilTelefone").textContent = data.telefone;
          document.getElementById("perfilIdade").textContent = data.idade;
          document.getElementById("perfilEmail").textContent = data.email;
          document.getElementById("perfilSobre").textContent = data.sobre || "";

          document.getElementById("perfilContainer").style.display = "block";
        });

        document.getElementById("editNome").addEventListener("click", () => editarCampo("perfilNome", "nome"));
        document.getElementById("editCidade").addEventListener("click", () => editarCampo("perfilCidade", "cidade"));
        document.getElementById("editTelefone").addEventListener("click", () => editarCampo("perfilTelefone", "telefone"));
        document.getElementById("editIdade").addEventListener("click", () => editarCampo("perfilIdade", "idade"));
        document.getElementById("editEmail").addEventListener("click", () => editarCampo("perfilEmail", "email"));
        document.getElementById("editSobre").addEventListener("click", () => editarCampo("perfilSobre", "sobre"));
      } // <- fechamento do if (!querySnapshot.empty)
    } catch (error) {
      console.error("Erro ao buscar dados do usu√°rio:", error);
    }
  } else {
    console.log("Nenhum usu√°rio logado");
  }
});




const painelUsuario = document.querySelector(".painel-usuario");
const formCorreioElegante = document.getElementById("formCorreioElegante");
const formBug = document.getElementById("formBug");
const formTemplate = document.getElementById("formTemplate");
const formConfirmarPresenca = document.getElementById("formConfirmarPresenca");
const btnVerPerfil = document.getElementById("btnVerPerfil");
const perfilContainer = document.getElementById("perfilContainer");
const btnConfirmarPresenca = document.getElementById("btnConfirmarPresenca");

function closeAllForms() {
  // Fechar todos os formul√°rios e resetar a cor do fundo
  formCorreioElegante.style.display = "none";
  formBug.style.display = "none";
  formTemplate.style.display = "none";
  formConfirmarPresenca.style.display = "none";
  perfilContainer.style.display = "none";

  // Resetar a cor de fundo do body
  document.body.classList.remove("bg-correio-elegante", "bg-relatar-bug", "bg-criar-template", "bg-confirmar-presenca", "bg-editar-perfil");
}

document.getElementById("btnEnviarCorreioElegante").addEventListener("click", function () {
  const isVisible = formCorreioElegante.style.display === "block";
  closeAllForms(); // Fechar todos os formul√°rios antes
  document.body.classList.add("bg-correio-elegante"); // Mudar a cor de fundo do body
  formCorreioElegante.style.display = isVisible ? "none" : "block";
});

document.getElementById("relatarBugBtn").addEventListener("click", function () {
  const isVisible = formBug.style.display === "block";
  closeAllForms(); // Fechar todos os formul√°rios antes
  document.body.classList.add("bg-relatar-bug"); // Mudar a cor de fundo do body
  formBug.style.display = isVisible ? "none" : "block";
});

document.getElementById("btnCriarTemplate").addEventListener("click", function () {
  const isVisible = formTemplate.style.display === "block";
  closeAllForms(); // Fechar todos os formul√°rios antes
  document.body.classList.add("bg-criar-template"); // Mudar a cor de fundo do body
  formTemplate.style.display = isVisible ? "none" : "block";
});

btnConfirmarPresenca.addEventListener("click", function () {
  const isVisible = formConfirmarPresenca.style.display === "block";
  closeAllForms(); // Fechar todos os formul√°rios antes
  document.body.classList.add("bg-confirmar-presenca"); // Mudar a cor de fundo do body
  formConfirmarPresenca.style.display = isVisible ? "none" : "block";
});

btnVerPerfil.addEventListener("click", function () {
  const isVisible = perfilContainer.style.display === "block";
  closeAllForms(); // Fechar todos os formul√°rios antes
  perfilContainer.style.display = isVisible ? "none" : "block";
  document.body.classList.add("bg-editar-perfil"); // Mudar a cor de fundo do body
});

document.getElementById("correioForm").addEventListener("submit", function(event) {
  event.preventDefault();

  const destinatario = document.getElementById("destinatario").value;
  const remetente = document.getElementById("remetente").value;
  const mensagem = document.getElementById("mensagem").value;

  addDoc(collection(db, "correioElegante"), {
    destinatario,
    remetente,
    mensagem,
    timestamp: serverTimestamp(),
  }).then(() => {
    document.getElementById("correioStatus").style.display = "block";
    document.getElementById("correioForm").reset();
  }).catch(error => {
    console.error("Erro ao enviar correio elegante", error);
  });
});

document.getElementById("bugForm").addEventListener("submit", function(event) {
  event.preventDefault();
  
  const titulo = document.getElementById("titulo").value;
  const descricao = document.getElementById("descricao").value;

  addDoc(collection(db, "bugs"), {
    titulo,
    descricao,
    timestamp: serverTimestamp(),
  }).then(() => {
    document.getElementById("bugStatus").style.display = "block";
    document.getElementById("bugForm").reset();
  }).catch(error => {
    console.error("Erro ao relatar bug", error);
  });
});

document.getElementById("gerarTemplate").addEventListener("click", function () {
  const nome = document.getElementById("nome").value;
  const idade = document.getElementById("idade").value;
  const aniversario = document.getElementById("aniversario").value;
  const signo = document.getElementById("signo").value;
  const altura = document.getElementById("altura").value;
  const cidadeBairro = document.getElementById("cidadeBairro").value;
  const estadoCivil = document.getElementById("estadoCivil").value;
  const hobbies = document.getElementById("hobbies").value;
  const instagram = document.getElementById("instagram").value;

  const conteudo = `
OL√Å MENINOS, TUDO BOM?!

NOVATOS SEJAM BEM VINDOS ü©µ

Pedimos a todos que se apresente com foto, e que sigam as regras do grupo (importante ter a foto do perfil aberta a todos) ‚ù§

üòá NOME: ${nome}
‚è≥ IDADE: ${idade}
ü•≥ ANIVERS√ÅRIO: ${aniversario}
‚ù§ SIGNO: ${signo}
‚¨Ü ALTURA: ${altura}
üì¨ CIDADE E BAIRRO SP: ${cidadeBairro}
‚ù§ ESTADO CIVIL: ${estadoCivil}
üéÆ HOBBIES: ${hobbies}
üì∏ INSTA: ${instagram}

Qualquer problema os ADM est√£o √† disposi√ß√£o`;

  const resultadoTemplate = document.getElementById("resultadoTemplate");
  resultadoTemplate.textContent = conteudo;
  resultadoTemplate.style.display = "block";

  document.getElementById("formTemplate").style.display = "none";
  document.getElementById("copiarTexto").style.display = "inline-block";

  if (typeof db !== "undefined") {
    addDoc(collection(db, "templates"), {
      nome,
      idade,
      aniversario,
      signo,
      altura,
      cidadeBairro,
      estadoCivil,
      hobbies,
      instagram,
      timestamp: serverTimestamp(),
    }).catch(error => {
      console.error("Erro ao criar template", error);
    });
  }

  document.getElementById("templateForm").reset();
});

document.getElementById("copiarTexto").addEventListener("click", function () {
  const texto = document.getElementById("resultadoTemplate").textContent;
  navigator.clipboard.writeText(texto)
    .then(() => alert("Texto copiado com sucesso!"))
    .catch(() => alert("Erro ao copiar o texto."));
});



  // Confirmar Presen√ßa
  const confirmaQuery = query(collection(db, "roles"), orderBy("data", "desc"), limit(1));
getDocs(confirmaQuery)
  .then((querySnapshot) => {
    if (!querySnapshot.empty) {
      const roleDoc = querySnapshot.docs[0];
      const roleData = roleDoc.data();

      document.getElementById("nomeRole").textContent = roleData.nome;
      document.getElementById("dataRole").textContent = roleData.data;

      document.getElementById("presencaForm").dataset.nomeRole = roleData.nome;
      document.getElementById("presencaForm").dataset.dataRole = roleData.data;
    }
  })
  .catch((error) => {
    console.error("Erro ao buscar rol√™:", error);
  });

  document.getElementById("presencaForm").addEventListener("submit", function(event) {
  event.preventDefault();

  const presenca = document.getElementById("presenca").value;
  const nomeUsuario = document.getElementById("nomeUsuario").value.trim();
  const nomeRole = event.target.dataset.nomeRole;
  const dataRole = event.target.dataset.dataRole;

  if (presenca === "vou" && nomeUsuario !== "") {
    addDoc(collection(db, "presencas"), {
      nome: nomeUsuario,
      role: nomeRole,
      data: dataRole,
      timestamp: serverTimestamp(),
    }).then(() => {
      document.getElementById("presencaStatus").style.display = "block";
    }).catch(error => {
      console.error("Erro ao confirmar presen√ßa", error);
    });
  }
});


  // Selecionando os bot√µes e os formul√°rios



// Fun√ß√£o para mostrar o formul√°rio de Confirmar Presen√ßa


const forms = [formCorreioElegante, formBug, formTemplate, formConfirmarPresenca,];

forms.forEach(form => {
  form.addEventListener("transitionend", function () {
    painelUsuario.classList.remove("bg-correio-elegante", "bg-relatar-bug", "bg-criar-template", "bg-confirmar-presenca", "bg-editar-perfil"
    );
    painelUsuario.classList.add("painel-usuario-bg")
  });
});

const botoes = [
  { id: 'btnEnviarCorreioElegante', classe: 'bg-correio-elegante' },
  { id: 'relatarBugBtn', classe: 'bg-relatar-bug' },
  { id: 'btnConfirmarPresenca', classe: 'bg-confirmar-presenca' },
  { id: 'btnCriarTemplate', classe: 'bg-criar-template' }
];

// Container do painel

// L√≥gica para limpar classes e aplicar a nova
botoes.forEach(botao => {
  const elemento = document.getElementById(botao.id);
  elemento.addEventListener('click', () => {
    // Remove todas as classes de fundo
    painelUsuario.classList.remove('bg-correio-elegante', 'bg-relatar-bug', 'bg-confirmar-presenca', 'bg-criar-template', 'bg-editar-perfil');
    
    // Adiciona a classe correspondente ao bot√£o clicado
    painelUsuario.classList.add(botao.classe);
  });
});
</script>

</body>
</html>